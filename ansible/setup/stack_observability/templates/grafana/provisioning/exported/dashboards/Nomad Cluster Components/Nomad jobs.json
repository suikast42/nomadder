{"annotations":{"list":[{"builtIn":1,"datasource":{"type":"datasource","uid":"grafana"},"enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations \u0026 Alerts","target":{"limit":100,"matchAny":false,"tags":[],"type":"dashboard"},"type":"dashboard"}]},"description":"Nomad jobs metrics","editable":true,"fiscalYearStartMonth":0,"gnetId":6281,"graphTooltip":0,"id":139,"links":[],"liveNow":false,"panels":[{"collapsed":false,"datasource":{"type":"prometheus","uid":"grafanacloud-prom"},"gridPos":{"h":1,"w":24,"x":0,"y":0},"id":9,"panels":[],"repeat":"instance","targets":[{"datasource":{"type":"prometheus","uid":"grafanacloud-prom"},"refId":"A"}],"title":"$instance","type":"row"},{"datasource":{"type":"prometheus","uid":"$datasource"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"insertNulls":false,"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":true,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":6,"w":12,"x":0,"y":1},"id":13,"links":[],"options":{"legend":{"calcs":[],"displayMode":"list","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"desc"}},"pluginVersion":"8.4.7","targets":[{"datasource":{"uid":"$datasource"},"editorMode":"code","expr":"sum(nomad_client_allocs_cpu_total_percent{agent_hostname=~\"$instance\", exported_job=~\"$job\",namespace=~\"$namespace\"}) by(agent_hostname, exported_job,namespace)","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"{{exported_job}} ","range":true,"refId":"A"}],"title":"CPU usage per job","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"$datasource"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"insertNulls":false,"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":true,"stacking":{"group":"A","mode":"normal"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"decbytes"},"overrides":[]},"gridPos":{"h":6,"w":12,"x":12,"y":1},"id":10,"links":[],"options":{"legend":{"calcs":[],"displayMode":"list","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"desc"}},"pluginVersion":"8.4.7","targets":[{"datasource":{"type":"prometheus","uid":"1_UFfQJGk"},"editorMode":"code","exemplar":true,"expr":"max(nomad_client_allocs_memory_usage{agent_hostname=~\"$instance\", exported_job=~\"$job\",namespace=~\"$namespace\"}) by(agent_hostname, exported_job,namespace)","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"{{exported_job}}","range":true,"refId":"A"}],"title":"Memory usage per job","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"$datasource"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"insertNulls":false,"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":true,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":6,"w":12,"x":0,"y":7},"id":2,"links":[],"options":{"legend":{"calcs":[],"displayMode":"list","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"desc"}},"pluginVersion":"8.4.7","targets":[{"datasource":{"uid":"$datasource"},"editorMode":"code","expr":"avg(nomad_client_allocs_cpu_total_percent{agent_hostname=~\"$instance\", exported_job=~\"$job\",namespace=~\"$namespace\", task_group=~\"$group\" ,task=~\"$task\"}) by(agent_hostname, exported_job,namespace,task_group,task)","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"{{exported_job}} {{task_group}} {{task}}","range":true,"refId":"A"}],"title":"CPU usage","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"$datasource"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"insertNulls":false,"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":true,"stacking":{"group":"A","mode":"normal"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"decbytes"},"overrides":[]},"gridPos":{"h":6,"w":12,"x":12,"y":7},"id":14,"links":[],"options":{"legend":{"calcs":[],"displayMode":"list","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"desc"}},"pluginVersion":"8.4.7","targets":[{"datasource":{"type":"prometheus","uid":"1_UFfQJGk"},"editorMode":"code","exemplar":true,"expr":"avg(nomad_client_allocs_memory_usage{agent_hostname=~\"$instance\", exported_job=~\"$job\",namespace=~\"$namespace\", task_group=~\"$group\" ,task=~\"$task\"}) by(agent_hostname, exported_job,namespace,task_group,task)","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"{{exported_job}} {{task_group}} {{task}}","range":true,"refId":"A"}],"title":"Memory usage","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"$datasource"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"insertNulls":false,"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":true,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"timeticks"},"overrides":[]},"gridPos":{"h":6,"w":12,"x":0,"y":13},"id":3,"links":[],"options":{"legend":{"calcs":[],"displayMode":"list","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"desc"}},"pluginVersion":"8.4.7","targets":[{"datasource":{"type":"prometheus","uid":"1_UFfQJGk"},"editorMode":"code","exemplar":true,"expr":"avg(nomad_client_allocs_cpu_total_ticks{agent_hostname=~\"$instance\", exported_job=~\"$job\",namespace=~\"$namespace\", task_group=~\"$group\" ,task=~\"$task\"}) by(agent_hostname, exported_job,namespace,task_group,task)","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"{{exported_job}} {{task_group}} {{task}}","range":true,"refId":"A"}],"title":"CPU total ticks","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"$datasource"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"insertNulls":false,"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":true,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"decbytes"},"overrides":[]},"gridPos":{"h":6,"w":12,"x":12,"y":13},"id":7,"links":[],"options":{"legend":{"calcs":[],"displayMode":"list","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"desc"}},"pluginVersion":"8.4.7","targets":[{"datasource":{"type":"prometheus","uid":"1_UFfQJGk"},"editorMode":"code","exemplar":true,"expr":"avg(nomad_client_allocs_memory_cache{agent_hostname=~\"$instance\", exported_job=~\"$job\",namespace=~\"$namespace\", task_group=~\"$group\" ,task=~\"$task\"}) by(agent_hostname, exported_job,namespace,task_group,task)","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"{{exported_job}} {{task_group}} {{task}}","range":true,"refId":"A"}],"title":"Memory cache","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"$datasource"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"insertNulls":false,"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":true,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"percentunit"},"overrides":[]},"gridPos":{"h":6,"w":12,"x":0,"y":19},"id":11,"links":[],"options":{"legend":{"calcs":[],"displayMode":"list","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"desc"}},"pluginVersion":"8.4.7","targets":[{"datasource":{"uid":"$datasource"},"editorMode":"code","expr":"(avg(nomad_client_allocs_cpu_total_ticks{agent_hostname=~\"$instance\", exported_job=~\"$job\",namespace=~\"$namespace\", task_group=~\"$group\" ,task=~\"$task\"}) by(agent_hostname, exported_job,namespace,task_group,task)) / (avg(nomad_client_allocs_cpu_allocated{agent_hostname=~\"$instance\", exported_job=~\"$job\",namespace=~\"$namespace\", task_group=~\"$group\" ,task=~\"$task\"}) by(agent_hostname, exported_job,namespace,task_group,task))","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"{{exported_job}} {{task_group}} {{task}}","range":true,"refId":"A"}],"title":"CPU overconsumption","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"$datasource"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"insertNulls":false,"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":true,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"percentunit"},"overrides":[]},"gridPos":{"h":6,"w":12,"x":12,"y":19},"id":12,"links":[],"options":{"legend":{"calcs":[],"displayMode":"list","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"desc"}},"pluginVersion":"8.4.7","targets":[{"datasource":{"uid":"$datasource"},"editorMode":"code","expr":"(avg(nomad_client_allocs_memory_usage{agent_hostname=~\"$instance\", exported_job=~\"$job\",namespace=~\"$namespace\", task_group=~\"$group\" ,task=~\"$task\"}) by(agent_hostname, exported_job,namespace,task_group,task)) / (avg(nomad_client_allocs_memory_allocated{agent_hostname=~\"$instance\", exported_job=~\"$job\",namespace=~\"$namespace\", task_group=~\"$group\" ,task=~\"$task\"}) by(agent_hostname, exported_job,namespace,task_group,task))","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"{{exported_job}} {{task_group}} {{task}}","range":true,"refId":"A"}],"title":"Memory overconsumption","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"$datasource"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"insertNulls":false,"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":true,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green"},{"color":"red","value":80}]},"unit":"decbytes"},"overrides":[]},"gridPos":{"h":6,"w":12,"x":0,"y":25},"id":6,"links":[],"options":{"legend":{"calcs":[],"displayMode":"list","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"desc"}},"pluginVersion":"8.4.7","targets":[{"datasource":{"uid":"$datasource"},"editorMode":"code","expr":"avg(nomad_client_allocs_memory_rss{job=~\"$job\", instance=~\"$instance\"}) by(exported_job, task)","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"{{task}}","range":true,"refId":"A"}],"title":"RSS","type":"timeseries"}],"refresh":"30s","schemaVersion":39,"tags":["nomad-integration"],"templating":{"list":[{"current":{"selected":false,"text":"grafanacloud-k3d-prom","value":"grafanacloud-k3d-prom"},"hide":0,"includeAll":false,"label":"Data Source","multi":false,"name":"datasource","options":[],"query":"prometheus","queryValue":"","refresh":1,"regex":"(?!grafanacloud-usage|grafanacloud-ml-metrics).+","skipUrlSync":false,"type":"datasource"},{"allValue":".+","current":{"selected":true,"text":["All"],"value":["$__all"]},"datasource":{"uid":"$datasource"},"definition":"","hide":0,"includeAll":true,"label":"instance","multi":true,"name":"instance","options":[],"query":{"query":"label_values(nomad_client_uptime{datacenter=~\"$datacenter\"}, instance)","refId":"prometheus-instance-Variable-Query"},"refresh":2,"regex":"","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tagsQuery":"","type":"query","useTags":false},{"current":{"isNone":true,"selected":false,"text":"None","value":""},"datasource":{"uid":"$datasource"},"definition":"label_values(nomad_client_uptime, datacenter)","hide":0,"includeAll":false,"label":"DC","multi":false,"name":"datacenter","options":[],"query":{"query":"label_values(nomad_client_uptime, datacenter)","refId":"StandardVariableQuery"},"refresh":1,"regex":"","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tagsQuery":"","type":"query","useTags":false},{"current":{"selected":true,"text":["default"],"value":["default"]},"datasource":{"uid":"$datasource"},"definition":"label_values(nomad_client_allocs_cpu_allocated,namespace)","hide":0,"includeAll":true,"label":"namespace","multi":true,"name":"namespace","options":[],"query":{"qryType":1,"query":"label_values(nomad_client_allocs_cpu_allocated,namespace)","refId":"PrometheusVariableQueryEditor-VariableQuery"},"refresh":1,"regex":"","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tagsQuery":"","type":"query","useTags":false},{"allValue":".+","current":{"selected":false,"text":"All","value":"$__all"},"datasource":{"type":"prometheus","uid":"${datasource}"},"definition":"label_values(nomad_client_allocs_cpu_total_percent,exported_job)","hide":0,"includeAll":true,"label":"job","multi":true,"name":"job","options":[],"query":{"qryType":1,"query":"label_values(nomad_client_allocs_cpu_total_percent,exported_job)","refId":"PrometheusVariableQueryEditor-VariableQuery"},"refresh":1,"regex":"","skipUrlSync":false,"sort":0,"type":"query"},{"allValue":".+","current":{"selected":false,"text":"All","value":"$__all"},"datasource":{"type":"prometheus","uid":"${datasource}"},"definition":"label_values(nomad_client_allocs_cpu_allocated{exported_job=~\"$job\"},task_group)","hide":0,"includeAll":true,"label":"group","multi":true,"name":"group","options":[],"query":{"qryType":1,"query":"label_values(nomad_client_allocs_cpu_allocated{exported_job=~\"$job\"},task_group)","refId":"PrometheusVariableQueryEditor-VariableQuery"},"refresh":1,"regex":"","skipUrlSync":false,"sort":0,"type":"query"},{"allValue":".+","current":{"selected":true,"text":["All"],"value":["$__all"]},"datasource":{"type":"prometheus","uid":"${datasource}"},"definition":"label_values(nomad_client_allocs_cpu_total_percent{exported_job=~\"$job\", task_group=~\"$group\"},task)","hide":0,"includeAll":true,"label":"task","multi":true,"name":"task","options":[],"query":{"qryType":1,"query":"label_values(nomad_client_allocs_cpu_total_percent{exported_job=~\"$job\", task_group=~\"$group\"},task)","refId":"PrometheusVariableQueryEditor-VariableQuery"},"refresh":1,"regex":"","skipUrlSync":false,"sort":0,"type":"query"}]},"time":{"from":"now-30m","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"","title":"Nomad jobs","uid":"TvqbbhViz","version":25,"weekStart":""}