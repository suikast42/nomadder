- name: volumes
  become: true
  block:
  - name: "Create volumes"
    become: true
    file:
      state: directory
      owner: "{{item.user | default('root')}}"
      group: "{{item.group | default('root')}}"
      mode: "{{item.mode | default('0777')}}"
      path: "{{item.path}}"

  - name: Template nomad volume
    template:
      force: yes # replace the remote file when contents are different than the source.
      src: conf/nomad_client_volumes.j2
      dest: "{{nomad_conf_dir}}/nomad_volume_{{item.name}}.hcl"
      owner: "{{ nomad_user }}"
      group: "{{ nomad_group }}"